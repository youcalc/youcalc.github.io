{"version":3,"sources":["utils.ts"],"names":[],"mappings":"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","file":"utils.js","sourcesContent":["import { Board, BoardPiece } from './board'\r\n\r\nexport class Utils {\r\n  static readonly BIG_POSITIVE_NUMBER = 10 ** 9 + 7\r\n  static readonly BIG_NEGATIVE_NUMBER = -Utils.BIG_POSITIVE_NUMBER\r\n\r\n  static showMessage(message = '') {\r\n    const messageDOM = document.querySelector('.message')\r\n    if (!messageDOM) {\r\n      console.error('Message DOM is null!')\r\n      return\r\n    }\r\n    messageDOM.classList.remove('hidden')\r\n\r\n    const messageContentDOM = document.querySelector('.message-body-content')\r\n    if (!messageContentDOM) {\r\n      console.error('Message body content DOM is null!')\r\n      return\r\n    }\r\n    messageContentDOM.innerHTML = message\r\n\r\n    const messageDismissDOM = document.querySelector('.message-body-dismiss')\r\n    if (!messageDismissDOM) {\r\n      console.error('Message body dismiss DOM is null!')\r\n      return\r\n    }\r\n    const dismissHandler = () => {\r\n      messageDOM.classList.add('invisible')\r\n      messageDOM.addEventListener('transitionend', () => {\r\n        messageDOM.classList.add('hidden')\r\n        messageDOM.classList.remove('invisible')\r\n      })\r\n      messageDismissDOM.removeEventListener('click', dismissHandler)\r\n    }\r\n    messageDismissDOM.addEventListener('click', dismissHandler)\r\n  }\r\n\r\n  static drawCircle(\r\n    context: CanvasRenderingContext2D,\r\n    { x = 0, y = 0, r = 0, fillStyle = '', strokeStyle = '' }\r\n  ) {\r\n    context.save()\r\n    context.fillStyle = fillStyle\r\n    context.strokeStyle = strokeStyle\r\n    context.beginPath()\r\n    context.arc(x, y, r, 0, 2 * Math.PI, false)\r\n    context.fill()\r\n    context.restore()\r\n  }\r\n  /**\r\n   * @see http://stackoverflow.com/a/11770000/917957\r\n   * @static\r\n   * @param context Canvas 2D Context\r\n   * @param board   current board\r\n   */\r\n  static drawMask(board: Board) {\r\n    const context = board.context\r\n    context.save()\r\n    context.fillStyle = Board.MASK_COLOR\r\n    context.beginPath()\r\n    const doubleRadius = 2 * Board.PIECE_RADIUS\r\n    const tripleRadius = 3 * Board.PIECE_RADIUS\r\n    for (let y = 0; y < Board.ROWS; y++) {\r\n      for (let x = 0; x < Board.COLUMNS; x++) {\r\n        context.arc(\r\n          tripleRadius * x + Board.MASK_X_BEGIN + doubleRadius,\r\n          tripleRadius * y + Board.MASK_Y_BEGIN + doubleRadius,\r\n          Board.PIECE_RADIUS,\r\n          0,\r\n          2 * Math.PI\r\n        )\r\n        context.rect(\r\n          tripleRadius * x + Board.MASK_X_BEGIN + 2 * doubleRadius,\r\n          tripleRadius * y + Board.MASK_Y_BEGIN,\r\n          -2 * doubleRadius,\r\n          2 * doubleRadius\r\n        )\r\n      }\r\n    }\r\n    context.fill()\r\n    context.restore()\r\n  }\r\n\r\n  static clearCanvas(board: Board) {\r\n    board.context.clearRect(0, 0, board.canvas.width, board.canvas.height)\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param coord Coordinate of point to be checked\r\n   * @param columnXBegin X-Coordinate of N-th column\r\n   * @param radius Radius of a piece\r\n   */\r\n  static isCoordOnColumn(\r\n    coord: { x: number; y: number },\r\n    columnXBegin: number,\r\n    radius: number\r\n  ): boolean {\r\n    return (\r\n      (coord.x - columnXBegin) * (coord.x - columnXBegin) <= radius * radius\r\n    )\r\n  }\r\n\r\n  static getColumnFromCoord(coord: { x: number; y: number }) {\r\n    for (let i = 0; i < Board.COLUMNS; i++) {\r\n      if (\r\n        Utils.isCoordOnColumn(\r\n          coord,\r\n          3 * Board.PIECE_RADIUS * i +\r\n            Board.MASK_X_BEGIN +\r\n            2 * Board.PIECE_RADIUS,\r\n          Board.PIECE_RADIUS\r\n        )\r\n      ) {\r\n        return i\r\n      }\r\n    }\r\n    return -1\r\n  }\r\n\r\n  static getRandomColumnNumber(): number {\r\n    return Math.floor(Math.random() * Board.COLUMNS)\r\n  }\r\n  static choose(choice: Array<any>): any {\r\n    return choice[Math.floor(Math.random() * choice.length)]\r\n  }\r\n\r\n  /**\r\n   * @see https://esdiscuss.org/topic/promises-async-functions-and-requestanimationframe-together\r\n   */\r\n  static animationFrame() {\r\n    let resolve = null\r\n    const promise = new Promise(r => (resolve = r))\r\n    if (resolve) {\r\n      window.requestAnimationFrame(resolve)\r\n    }\r\n    return promise\r\n  }\r\n\r\n  static clone(array: Array<Array<any>>): Array<Array<any>> {\r\n    let arr = []\r\n    for (let i = 0; i < array.length; i++) {\r\n      arr[i] = array[i].slice()\r\n    }\r\n    return arr\r\n  }\r\n\r\n  static getMockPlayerAction(\r\n    map: Array<Array<number>>,\r\n    boardPiece: BoardPiece,\r\n    column: number\r\n  ): {\r\n    success: boolean\r\n    map: Array<Array<number>>\r\n  } {\r\n    const clonedMap = Utils.clone(map)\r\n    if (\r\n      clonedMap[0][column] !== BoardPiece.EMPTY ||\r\n      column < 0 ||\r\n      column >= Board.COLUMNS\r\n    ) {\r\n      return {\r\n        success: false,\r\n        map: clonedMap\r\n      }\r\n    }\r\n\r\n    let isColumnEverFilled = false\r\n    let row = 0\r\n    for (let i = 0; i < Board.ROWS - 1; i++) {\r\n      if (clonedMap[i + 1][column] !== BoardPiece.EMPTY) {\r\n        isColumnEverFilled = true\r\n        row = i\r\n        break\r\n      }\r\n    }\r\n    if (!isColumnEverFilled) {\r\n      row = Board.ROWS - 1\r\n    }\r\n    clonedMap[row][column] = boardPiece\r\n\r\n    return {\r\n      success: true,\r\n      map: clonedMap\r\n    }\r\n  }\r\n\r\n  /**\r\n   * From Mozilla Developer Network\r\n   * https://developer.mozilla.org/en-US/docs/Web/Events/resize\r\n   */\r\n  static onresize() {\r\n    var callbacks: Array<Function> = [],\r\n      running = false\r\n\r\n    // fired on resize event\r\n    function resize() {\r\n      if (!running) {\r\n        running = true\r\n\r\n        if (window.requestAnimationFrame) {\r\n          window.requestAnimationFrame(runCallbacks)\r\n        } else {\r\n          setTimeout(runCallbacks, 66)\r\n        }\r\n      }\r\n    }\r\n\r\n    // run the actual callbacks\r\n    function runCallbacks() {\r\n      callbacks.forEach(function(callback) {\r\n        callback()\r\n      })\r\n      running = false\r\n    }\r\n\r\n    // adds callback to loop\r\n    function addCallback(callback: Function) {\r\n      if (callback) {\r\n        callbacks.push(callback)\r\n      }\r\n    }\r\n\r\n    return {\r\n      // public method to add additional callback\r\n      add: function(callback: Function) {\r\n        if (!callbacks.length) {\r\n          window.addEventListener('resize', resize)\r\n        }\r\n        addCallback(callback)\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}